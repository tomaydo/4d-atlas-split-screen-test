<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <title>Split Screen Test – Lützipedia 4D Atlas</title>

  <!-- Include the CesiumJS JavaScript and CSS files -->

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>

  <link href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

  <link href="style.css" rel="stylesheet">
  
  <style type="text/css">
    @import url(bucket.css);

    #slider {
      position: absolute;
      left: 50%;
      top: 0px;
      background-color: #d3d3d300;
      width: 3px;
      height: 100%;
      z-index: 9999;
    }

    #slider:hover {
      cursor: ew-resize;
    }

    #toolbarSelectLeft { z-index: 1; position: fixed; top: 5px; left: 5px; }
    #toolbarSelectRight { z-index: 1; position: fixed; top: 5px; left: 100px; }

  </style>

</head>

<body>

  <div id="cesiumContainer" class="fullSize">
    <div id="slider"></div>
  </div>
  <div id="loadingOverlay"><h1>Loading...</h1></div>
  <div id="toolbarSelectLeft"></div>
  <div id="toolbarSelectRight"></div>


  <script type="module">
    // Grant CesiumJS access to your ion assets
    Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMzI2ZGM3OC1lNzc0LTQ2NjAtYjk4My0xNTU4ZjBiNjVmYWQiLCJpZCI6MjExMzA0LCJpYXQiOjE3MTQwNTM4Nzh9.9Ukf8VP5V1LxG5J2n94eodXQijyDvWkuSIUNcs1T0Hg";

    const viewer = new Cesium.Viewer("cesiumContainer", {
      geocoder: false,
      sceneModePicker: false,
      homeButton: false,
      navigationHelpButton: false,
      baseLayerPicker: false,
      timeline: false, // Tageszeitleiste ausblenden
      animation: false, // Tageszeit-Animator ausblenden
    });

    // Asset Lookup tables ================================================

    // Left half of the screen:
    // Tilesets produced by the Cesium ion 3D Model Tiler
    const leftAssetIds = {
      "SEPT 2021": 2888406,
      "APR 2022": 2801591,
    };

    // Right half of the screen:
    // Tilesets produced by the Cesium ion Reality Tiler
    const rightAssetIds = {
      "SEPT 2021": 2888406,
      "APR 2022": 2801591,
    };



    // List of tileset names for creating options and indexing into the
    // lookup tables above.
    const tilesetNames = ["SEPT 2021", "APR 2022", "JUN 2023"];

    // Tileset Loading ====================================================

    // Create two primitive collections, one for each half of the screen.
    // This way we can clear one half of the screen at a time.
    const leftCollection = viewer.scene.primitives.add(
      new Cesium.PrimitiveCollection(),
    );
    const rightCollection = viewer.scene.primitives.add(
      new Cesium.PrimitiveCollection(),
    );

    // Load a tileset to one half of the screen, returning the tileset
    async function loadTileset(tilesetName, splitDirection) {
      const isLeft = splitDirection === Cesium.SplitDirection.LEFT;

      const assetIds = isLeft ? leftAssetIds : rightAssetIds;
      const collection = isLeft ? leftCollection : rightCollection;

      const assetId = assetIds[tilesetName];
      if (!Cesium.defined(assetId)) {
        collection.removeAll();
        return;
      }

      const side = splitDirection === Cesium.SplitDirection.LEFT ? "left" : "right";

      collection.removeAll();
      const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(assetId);
      tileset.splitDirection = splitDirection;

      collection.add(tileset);

      return tileset;
    }

    async function viewTileset(tilesetName, splitDirection) {
      const tileset = await loadTileset(tilesetName, splitDirection);
      viewer.zoomTo(tileset);
    }

    async function viewTilesets(tilesetName) {
      // Load the tilesets simultaneously
      viewTileset(tilesetName, Cesium.SplitDirection.LEFT);
      viewTileset(tilesetName, Cesium.SplitDirection.RIGHT);
    }



    // UI =================================================================

    // Tileset dropdown ---------------------------------------------------

    // The first tileset in the dropdown will automatically be selected.
    let selectedTilesetName = tilesetNames[0];

    function createOption(name) {
      return {
        text: name,
        onselect: function () {
          selectedTilesetName = name;
          viewTilesets(name).catch(console.error);
        },
      };
    }

    function createOptions() {
      const options = tilesetNames.map(createOption);
      return options;
    }

    Sandcastle.addToolbarMenu(createOptions(), "toolbarSelectLeft");
    Sandcastle.addToolbarMenu(createOptions(), "toolbarSelectRight");





    // Splitter ----------------------------------------------------------

    // This code is the same as in the 3D Tiles Compare Sandcastle.

    // Sync the position of the slider with the split position
    const slider = document.getElementById("slider");
    viewer.scene.splitPosition = slider.offsetLeft / slider.parentElement.offsetWidth;

    const handler = new Cesium.ScreenSpaceEventHandler(slider);

    let moveActive = false;

    function move(movement) {
      if (!moveActive) {
        return;
      }

      const relativeOffset = movement.endPosition.x;
      const splitPosition =
        (slider.offsetLeft + relativeOffset) / slider.parentElement.offsetWidth;
      slider.style.left = `${100.0 * splitPosition}%`;
      viewer.scene.splitPosition = splitPosition;
    }

    handler.setInputAction(function () {
      moveActive = true;
    }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    handler.setInputAction(function () {
      moveActive = true;
    }, Cesium.ScreenSpaceEventType.PINCH_START);

    handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE);

    handler.setInputAction(function () {
      moveActive = false;
    }, Cesium.ScreenSpaceEventType.LEFT_UP);
    handler.setInputAction(function () {
      moveActive = false;
    }, Cesium.ScreenSpaceEventType.PINCH_END);


  </script>

 </div>

</body>

</html>
