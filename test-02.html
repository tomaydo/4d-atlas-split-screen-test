<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <title>Split Screen Test – Lützipedia 4D Atlas</title>

  <!-- Include the CesiumJS JavaScript and CSS files -->

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>

  <link href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

  <link href="style.css" rel="stylesheet">
  
  <style type="text/css">
    @import url(bucket.css);

    #slider {
      position: absolute;
      left: 50%;
      top: 0px;
      background-color: #d3d3d300;
      width: 3px;
      height: 100%;
      z-index: 9999;
    }

    #slider:hover {
      cursor: ew-resize;
    }

    #toolbarSelectLeft { z-index: 1; position: fixed; top: 5px; left: 36%; }
    #toolbarSelectRight { z-index: 1; position: fixed; top: 5px; left: 52%; }

  </style>

</head>

<body>

  <div id="cesiumContainer" class="fullSize">
    <div id="slider"></div>
  </div>
  <div id="loadingOverlay"><h1>Loading...</h1></div>
  <div id="toolbarSelectLeft"></div>
  <div id="toolbarSelectRight"></div>


  <script type="module">
    // Grant CesiumJS access to your ion assets
    Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMzI2ZGM3OC1lNzc0LTQ2NjAtYjk4My0xNTU4ZjBiNjVmYWQiLCJpZCI6MjExMzA0LCJpYXQiOjE3MTQwNTM4Nzh9.9Ukf8VP5V1LxG5J2n94eodXQijyDvWkuSIUNcs1T0Hg";

    const viewer = new Cesium.Viewer("cesiumContainer", {
      terrainProvider: await Cesium.CesiumTerrainProvider.fromIonAssetId(1),
      geocoder: false,
      sceneModePicker: false,
      homeButton: false,
      navigationHelpButton: false,
      baseLayerPicker: false,
      timeline: false, // Tageszeitleiste ausblenden
      animation: false, // Tageszeit-Animator ausblenden
    });
    viewer.scene.globe.depthTestAgainstTerrain = false; // OBJs immer über Grund rendern

    // Asset Lookup tables ================================================

    // Asset IDs
    const assetIds = {
      "SEPT 2021": 2888406,
      "APR 2022": 2801591,
      "JUN 2023": 2882527,
    };

    const luetzi = await Cesium.Cesium3DTileset.fromIonAssetId(2888406);
    viewer.zoomTo(luetzi);

    // List of tileset names for creating options and indexing into the
    // lookup tables above.
    const tilesetNames = ["Select ...", "SEPT 2021", "APR 2022", "JUN 2023"];

    // Tileset Loading ====================================================

    // Create two primitive collections, one for each half of the screen.
    // This way we can clear one half of the screen at a time.
    const leftCollection = viewer.scene.primitives.add(
      new Cesium.PrimitiveCollection(),
    );
    const rightCollection = viewer.scene.primitives.add(
      new Cesium.PrimitiveCollection(),
    );

    // Load a tileset to LEFT half of the screen, returning the tileset
    async function loadLeftTileset(tilesetName) {

      const collection = leftCollection;

      const assetId = assetIds[tilesetName];
      if (!Cesium.defined(assetId)) {
        collection.removeAll();
        return;
      }

      collection.removeAll();
      const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(assetId);
      tileset.splitDirection = Cesium.SplitDirection.LEFT;

      collection.add(tileset);
      
      if (tilesetName === "JUN 2023") {
        const spLines = await Cesium.Cesium3DTileset.fromIonAssetId(2553946);
        spLines.splitDirection = Cesium.SplitDirection.LEFT;
        collection.add(spLines);
      }

      return tileset;
    }

    // Load a tileset to RIGHT half of the screen, returning the tileset
    async function loadRightTileset(tilesetName) {

      const collection = rightCollection;

      const assetId = assetIds[tilesetName];
      if (!Cesium.defined(assetId)) {
        collection.removeAll();
        return;
      }

      collection.removeAll();
      const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(assetId);
      tileset.splitDirection = Cesium.SplitDirection.RIGHT;

      collection.add(tileset);
      
      if (tilesetName === "JUN 2023") {
        const spLines = await Cesium.Cesium3DTileset.fromIonAssetId(2553946);
        spLines.splitDirection = Cesium.SplitDirection.RIGHT;
        collection.add(spLines);
      }

      return tileset;
    }

    async function viewLeftTileset(tilesetName, splitDirection) {
      const tileset = await loadLeftTileset(tilesetName, splitDirection);
      //viewer.zoomTo(tileset);
    }

    async function viewRightTileset(tilesetName, splitDirection) {
      const tileset = await loadRightTileset(tilesetName, splitDirection);
      //viewer.zoomTo(tileset);
    }

    async function viewBothTilesets(tilesetName) {
      // Load the tilesets simultaneously
      viewLeftTileset(tilesetName, Cesium.SplitDirection.LEFT);
      viewRightTileset(tilesetName, Cesium.SplitDirection.RIGHT);
    }



    // UI =================================================================

    // Tileset dropdown ---------------------------------------------------

    // The first tileset in the dropdown will automatically be selected.
    let selectedTilesetLeft = tilesetNames[1];

    function createLeftOption(name) {
      return {
        text: name,
        onselect: function () {
          selectedTilesetLeft = name;
          viewLeftTileset(name, Cesium.SplitDirection.LEFT).catch(console.error);
        },
      };
    }

    function createLeftOptions() {
      const options = tilesetNames.map(createLeftOption);
      return options;
    }

    let selectedTilesetRight = tilesetNames[1];

    function createRightOption(name) {
      return {
        text: name,
        onselect: function () {
          selectedTilesetRight = name;
          viewRightTileset(name, Cesium.SplitDirection.RIGHT).catch(console.error);
        },
      };
    }

    function createRightOptions() {
      const options = tilesetNames.map(createRightOption);
      return options;
    }

    Sandcastle.addToolbarMenu(createLeftOptions(), "toolbarSelectLeft");
    Sandcastle.addToolbarMenu(createRightOptions(), "toolbarSelectRight");



    // Splitter ----------------------------------------------------------

    // This code is the same as in the 3D Tiles Compare Sandcastle.

    // Sync the position of the slider with the split position
    const slider = document.getElementById("slider");
    viewer.scene.splitPosition = slider.offsetLeft / slider.parentElement.offsetWidth;

    const handler = new Cesium.ScreenSpaceEventHandler(slider);

    let moveActive = false;

    function move(movement) {
      if (!moveActive) {
        return;
      }

      const relativeOffset = movement.endPosition.x;
      const splitPosition =
        (slider.offsetLeft + relativeOffset) / slider.parentElement.offsetWidth;
      slider.style.left = `${100.0 * splitPosition}%`;
      viewer.scene.splitPosition = splitPosition;
    }

    handler.setInputAction(function () {
      moveActive = true;
    }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    handler.setInputAction(function () {
      moveActive = true;
    }, Cesium.ScreenSpaceEventType.PINCH_START);

    handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE);

    handler.setInputAction(function () {
      moveActive = false;
    }, Cesium.ScreenSpaceEventType.LEFT_UP);
    handler.setInputAction(function () {
      moveActive = false;
    }, Cesium.ScreenSpaceEventType.PINCH_END);




  </script>

 </div>

</body>

</html>
